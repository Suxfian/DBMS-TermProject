<!DOCTYPE html>
<html class="dark" lang="tr">
<head>
    <meta charset="utf-8"/>
    <title>Gelişmiş Raporlar</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <script> tailwind.config = { darkMode: "class", theme: { extend: { colors: { "primary": "#2b8cee", "dark-bg": "#101922" } } } } </script>
    <style>.fade-out { opacity: 0; transition: opacity 0.5s ease; }</style>
</head>
<body class="bg-[#101922] text-white font-sans flex h-screen">

    <aside class="w-64 bg-[#111a22] border-r border-gray-800 flex flex-col">
        <div class="p-6 flex items-center gap-3 border-b border-gray-800">
            <span class="material-symbols-outlined text-primary text-3xl">hub</span>
            <div><h1 class="font-bold text-sm">{{ company_name }}</h1><p class="text-[10px] text-gray-500 mt-0.5">Yönetim Paneli</p></div>
        </div>
        <nav class="flex-1 p-4 space-y-2">
            <a href="/dashboard" class="flex items-center gap-3 p-3 text-gray-400 hover:bg-gray-800 rounded-lg transition"><span class="material-symbols-outlined">dashboard</span> Genel Bakış</a>
            <a href="/orders" class="flex items-center gap-3 p-3 text-gray-400 hover:bg-gray-800 rounded-lg transition"><span class="material-symbols-outlined">shopping_cart</span> Siparişler</a>
            
            {% if role != 'Muhasebe_Gorevlisi' %}
            <a href="/products" class="flex items-center gap-3 p-3 text-gray-400 hover:bg-gray-800 rounded-lg transition"><span class="material-symbols-outlined">inventory_2</span> Envanter</a>
            {% endif %}
            
            {% if role == 'Sirket_Admin' or role == 'Super_Admin' %}
            <a href="/integrations" class="flex items-center gap-3 p-3 text-gray-400 hover:bg-gray-800 rounded-lg transition"><span class="material-symbols-outlined">link</span> Entegrasyon</a>
            {% endif %}
            
            {% if role != 'Depo_Gorevlisi' %}
            <a href="/reports" class="flex items-center gap-3 p-3 bg-primary/20 text-primary rounded-lg transition"><span class="material-symbols-outlined fill">bar_chart</span> Raporlar</a>
            {% endif %}
            
            <a href="/settings" class="flex items-center gap-3 p-3 text-gray-400 hover:bg-gray-800 rounded-lg transition"><span class="material-symbols-outlined">settings</span> Sistem Ayarları</a>
            
            <a href="/logout" class="flex items-center gap-3 p-3 text-red-400 hover:bg-red-500/10 rounded-lg mt-auto"><span class="material-symbols-outlined">logout</span> Çıkış Yap</a>
        </nav>
    </aside>

    <main class="flex-1 p-8 overflow-y-auto">
        <header class="mb-8">
            <h1 class="text-3xl font-bold">Gelişmiş Satış Raporu</h1>
            <p class="text-gray-400">Veritabanı VIEW'i üzerinden oluşturulan detaylı analiz.</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="bg-[#192633] p-6 rounded-xl border border-gray-800"><p class="text-gray-400 text-sm mb-1">Toplam Ciro (View)</p><h3 class="text-3xl font-bold text-green-400">{{ "{:,.2f}".format(total_sales) }} ₺</h3></div>
            <div class="bg-[#192633] p-6 rounded-xl border border-gray-800"><p class="text-gray-400 text-sm mb-1">En Çok Satış Yapılan Şehir</p><h3 class="text-3xl font-bold text-blue-400">{{ top_city }}</h3></div>
        </div>

        <div class="bg-[#192633] rounded-xl border border-gray-800 overflow-hidden shadow-xl">
            <table class="w-full text-left text-sm">
                <thead class="bg-black/20 text-gray-400 uppercase text-xs">
                    <tr><th class="p-4">Tarih</th><th class="p-4">Sipariş No</th><th class="p-4">Müşteri</th><th class="p-4">Ürün</th><th class="p-4">Şehir</th><th class="p-4 text-center">Adet</th><th class="p-4 text-right">Tutar</th><th class="p-4 text-right">Durum</th></tr>
                </thead>
                <tbody class="divide-y divide-gray-800 text-gray-300">
                    {% for row in report_data %}
                    <tr class="hover:bg-gray-800/30 transition">
                        <td class="p-4 text-gray-500 text-xs">{{ row[1].strftime('%d.%m.%Y') }}</td><td class="p-4 font-mono text-blue-300">{{ row[0] }}</td><td class="p-4 font-bold">{{ row[3] }}</td><td class="p-4">{{ row[5] }} <span class="text-gray-500 text-xs">({{ row[6] }})</span></td><td class="p-4">{{ row[4] }}</td><td class="p-4 text-center">{{ row[7] }}</td><td class="p-4 text-right font-bold text-white">{{ "{:,.2f}".format(row[9]) }} ₺</td><td class="p-4 text-right"><span class="px-2 py-1 rounded text-xs bg-gray-700 text-gray-300">{{ status_map[row[10]] }}</span></td>
                    </tr>
                    {% else %}<tr><td colspan="8" class="p-8 text-center text-gray-500">Henüz raporlanacak veri yok.</td></tr>{% endfor %}
                </tbody>
            </table>
        </div>
    </main>
</body>
</html>